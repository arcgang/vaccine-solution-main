{"version":3,"sources":["webpack:///./src/pages/solution/cold-monitoring/index.mdx"],"names":["_frontmatter","makeShortcode","name","props","console","warn","PageDescription","AnchorLinks","AnchorLink","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","isMDXComponent"],"mappings":"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","file":"component---src-pages-solution-cold-monitoring-index-mdx-4f64d7c4a8212c04f6b7.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/vaccine-solution-main/vaccine-solution-main/docs/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst PageDescription = makeShortcode(\"PageDescription\");\nconst AnchorLinks = makeShortcode(\"AnchorLinks\");\nconst AnchorLink = makeShortcode(\"AnchorLink\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <PageDescription mdxType=\"PageDescription\">\nThis microservice aims to monitor the cold-chain over time and to assess if the refrigerator is still running according to specifications.\n    </PageDescription>\n    <AnchorLinks mdxType=\"AnchorLinks\">\n  <AnchorLink mdxType=\"AnchorLink\">Overview</AnchorLink>\n  <AnchorLink mdxType=\"AnchorLink\">Build</AnchorLink>\n   <AnchorLink mdxType=\"AnchorLink\">Usage Details</AnchorLink>\n    </AnchorLinks>\n    <h2>{`Overview`}</h2>\n    <p>{`The reefer monitoring agent gets telemetry events from the `}<inlineCode parentName=\"p\">{`telemetries`}</inlineCode>{` Kafka topic and processes them using stateful operation on time window, and then creates reefer-cold-chain-violation event to the `}<inlineCode parentName=\"p\">{`reefer`}</inlineCode>{` Kafka topic in case the temperature goes over a define threshold over a specific time period. For each received metrics it can, optionally, call an anomaly detection service to compute the risk of failure. `}</p>\n    <span {...{\n      \"className\": \"gatsby-resp-image-wrapper\",\n      \"style\": {\n        \"position\": \"relative\",\n        \"display\": \"block\",\n        \"marginLeft\": \"auto\",\n        \"marginRight\": \"auto\",\n        \"maxWidth\": \"1152px\"\n      }\n    }}>{`\n      `}<span parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-background-image\",\n        \"style\": {\n          \"paddingBottom\": \"53.125%\",\n          \"position\": \"relative\",\n          \"bottom\": \"0\",\n          \"left\": \"0\",\n          \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACYUlEQVQoz22Ty2sTQRzH9+RNxX/Bgw8EEUQo9VDxpCCI1IuIogiefCEoolgEDxYqFHKol1CMjyIebKttQawg1QpRm5qqMUkT0tQ2z25389rNJrv5OLPbWA/9Dd+Z2fnNfH8Pvqu0aOG05Lw+GrZNvdHEanqQZ6z5mk0bafF0ge3He9l1so+d3X3sFmt0IY/itBw8UrE6DtWqyZHLfg6c9XHwwgD7TvUz+v6HS1IpmRjVOuIy4cgS+0/3030zQPeNAB3nfPxMZtYJZWRHEtZMOoWz87yPY1f97DjxgFeTcy6hJbJ23GxBr9Z4/PozgyPT+Ic/8Xw8iFqqeITSyuUymq65+9yKRra4Sl7VyBRWyRWKrl9a0/ZKno38YVPHbbYdvseWrh62Huphbl5kaDs2EoZhYpom7QD/m/TVLcvrr+iptGgiy5k7T+gZGOOWb5SL91+wkFVRrIbFaqnEr2iCxeUs8ls+TqYXWUhnsMTeqHuBNgrmWfu8hSKnJVHe0GSQUDz978qH2Shj02FsoQDHabhVSJueS/F0YoahiRCBsW+ERZluKxwvoCLZM6Jnw1MhQrEU9bohSjf4GI4J0hg1o8bX34sYlpCP3eToJT/K3uts7rqLsucaV/pGXEIpNZdQFzLRax6WckUi8YRAknQmL1phoFdqfE/plIVc1JUiz8a/8DDwjkcvp+gdfMubKU8BdjtDTS1T0SpoRY1kLMFyeplUIkU8EkfNqZSFXy/qNKRkWq2NO7gmPTkUZ1XF1nUcAUtdYX5mhkgwiFko4JR0F3Y+75YrH8hM7NYaHA/tH0PiL+POEp7xPX19AAAAAElFTkSuQmCC')\",\n          \"backgroundSize\": \"cover\",\n          \"display\": \"block\"\n        }\n      }}></span>{`\n  `}<img parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-image\",\n        \"alt\": \"cold monitoring 1\",\n        \"title\": \"cold monitoring 1\",\n        \"src\": \"/vaccine-solution-main/static/592098bb7c68d4abdb6525813e4be606/3cbba/cold-monitoring-1.png\",\n        \"srcSet\": [\"/vaccine-solution-main/static/592098bb7c68d4abdb6525813e4be606/7fc1e/cold-monitoring-1.png 288w\", \"/vaccine-solution-main/static/592098bb7c68d4abdb6525813e4be606/a5df1/cold-monitoring-1.png 576w\", \"/vaccine-solution-main/static/592098bb7c68d4abdb6525813e4be606/3cbba/cold-monitoring-1.png 1152w\", \"/vaccine-solution-main/static/592098bb7c68d4abdb6525813e4be606/f5f59/cold-monitoring-1.png 1522w\"],\n        \"sizes\": \"(max-width: 1152px) 100vw, 1152px\",\n        \"style\": {\n          \"width\": \"100%\",\n          \"height\": \"100%\",\n          \"margin\": \"0\",\n          \"verticalAlign\": \"middle\",\n          \"position\": \"absolute\",\n          \"top\": \"0\",\n          \"left\": \"0\"\n        },\n        \"loading\": \"lazy\"\n      }}></img>{`\n    `}</span>\n    <p>{`In case of cold chain violation the impacted vaccine lots needs to be reported as spoiled via new records logged to the blockchain hyperledger. This is the responsability of the reefer manager microservice has it has visibility of the loaded vaccine lots for each container. Telemetry events have information on the sensors and the geolocation of the reefer.`}</p>\n    <p><strong parentName=\"p\">{`Github repository:`}</strong>{` `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/ibm-cloud-architecture/vaccine-monitoring-agent\"\n      }}>{`vaccine-monitoring-agent`}</a></p>\n    <p><strong parentName=\"p\">{`Kafka topics consumed from:`}</strong>{` telemetries as defined by:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`apiVersion: kafka.strimzi.io/v1beta1\n  kind: KafkaTopic\n  metadata:\n    name: telemetries\n    labels:\n      strimzi.io/cluster: event-streams\n  spec:\n    partitions: 10\n    replicas: 3\n    config:\n      retention.ms: 14400000\n      segment.bytes: 1073741824\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Kafka topics produced to:`}</strong>{` reefers in case of anomaly detection or cold chain violation`}</p>\n    <p><strong parentName=\"p\">{`Events reacted to:`}</strong>{` telemetry events like:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`public class TelemetryEvent {\n\n    public String containerID;\n    public Telemetry payload;\n    public String timestamp;\n    public String type;\n`}</code></pre>\n    <p>{`and the payload:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{` public String container_id;\n    public String measurement_time;\n    public String product_id;\n    public double temperature;\n    public double target_temperature; \n    public double ambiant_temperature; \n    public double kilowatts; \n    public double time_door_open;\n    public int content_type; \n    public int defrost_cycle;\n    public double oxygen_level; \n    public double nitrogen_level; \n    public double humidity_level;\n    public double target_humidity_level;\n    public double carbon_dioxide_level; \n    public boolean fan_1; \n    public boolean fan_2; \n    public boolean fan_3;\n    public double latitude;\n    public double longitude;\n  \n`}</code></pre>\n    <p><strong parentName=\"p\">{`Events produced:`}</strong>{` reefer anomaly detected and reefer cold chain violated`}</p>\n    <h3>{`Code structure`}</h3>\n    <p>{`The API is supported by the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/ibm-cloud-architecture/vaccine-monitoring-agent/blob/master/src/main/java/ibm/gse/eda/vaccine/coldchainagent/api/ContainerResource.java\"\n      }}>{`ContainerResource`}</a>{` class which exposes interactive query on the container id.`}</p>\n    <p>{`The core of the process is a Kafka Streams topology in the class `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/ibm-cloud-architecture/vaccine-monitoring-agent/blob/master/src/main/java/ibm/gse/eda/vaccine/coldchainagent/domain/TelemetryAssessor.java\"\n      }}>{`TelemetryAssessor`}</a>{`.`}</p>\n    <p>{`The `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/ibm-cloud-architecture/vaccine-monitoring-agent/blob/b591e6e338cb8e9a5a8da5dde44d299f669d2309/src/main/java/ibm/gse/eda/vaccine/coldchainagent/domain/TelemetryAssessor.java#L86-L133\"\n      }}>{`topology`}</a>{` processes telemetry records and build a new streams with the containerID as key, and the telemetry payload as value. Then it builds a Ktable to keep aggregate per container. The aggregate is defined in `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/ibm-cloud-architecture/vaccine-monitoring-agent/blob/master/src/main/java/ibm/gse/eda/vaccine/coldchainagent/domain/ReeferAggregate.java\"\n      }}>{`this ReeferAggregate class`}</a>{` and aims to keep max Temperature read so far, the number of time the maximum temperature is violated.\nFinally when a container reaches the maximum number of temperature violation, a new message is sent to a ‘reefer’ topic for down stream processing.`}</p>\n    <p>{`If you need to learn more on Kafka streams read `}<a parentName=\"p\" {...{\n        \"href\": \"https://ibm-cloud-architecture.github.io/refarch-eda/technology/kafka-streams/\"\n      }}>{`this introduction`}</a>{` and do `}<a parentName=\"p\" {...{\n        \"href\": \"https://ibm-cloud-architecture.github.io/refarch-eda/use-cases/kafka-streams/\"\n      }}>{`those labs`}</a>{` to learn more on how to program with Kafka Streams.`}</p>\n    <p>{`The nice capability of Quarkus app, is most of the work is in the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/ibm-cloud-architecture/vaccine-monitoring-agent/blob/master/src/main/resources/application.properties\"\n      }}>{`application.properties`}</a>{` configuration. The highlights of this configuration is the fact that once deploy to OpenShift the environment variables are defined in config map and secret:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`quarkus.openshift.env.configmaps=agent-cm\nquarkus.openshift.env.secrets=agent-secrets\n`}</code></pre>\n    <p>{`The SSL certificate for the server and the user are coming from secrets:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`quarkus.openshift.env.vars.KAFKA_CERT_PATH=/deployments/certs/server/ca.p12\nquarkus.openshift.env.mapping.KAFKA_CERT_PWD.from-secret=kafka-cluster-ca-cert\nquarkus.openshift.env.mapping.KAFKA_CERT_PWD.with-key=ca.password\nquarkus.openshift.mounts.es-cert.path=/deployments/certs/server\nquarkus.openshift.secret-volumes.es-cert.secret-name=kafka-cluster-ca-cert\n# TLS user\nquarkus.openshift.env.mapping.USER_CERT_PWD.from-secret=\\${KAFKA_USER}\nquarkus.openshift.env.mapping.USER_CERT_PWD.with-key=user.password\nquarkus.openshift.env.vars.USER_CERT_PATH=/deployments/certs/user/user.p12\nquarkus.openshift.mounts.user.path=/deployments/certs/user\nquarkus.openshift.secret-volumes.user.secret-name=\\${KAFKA_USER}\n`}</code></pre>\n    <p>{`The outgoing message sent to Kafka `}<inlineCode parentName=\"p\">{`reefer`}</inlineCode>{` topic is done via microprofile reactive messaging configuration and plugin:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`mp.messaging.outgoing.reefers.connector=smallrye-kafka\nmp.messaging.outgoing.reefers.topic=\\${REEFER_TOPIC:vaccine-reefers}\nmp.messaging.outgoing.reefers.key.serializer=org.apache.kafka.common.serialization.StringSerializer\nmp.messaging.outgoing.reefers.value.serializer=io.quarkus.kafka.client.serialization.JsonbSerializer\n`}</code></pre>\n    <p>{`Then the last part if for Kafka Streams.`}</p>\n    <h2>{`Build`}</h2>\n    <p>{`As a quarkus application it is possible to run locally with `}<inlineCode parentName=\"p\">{`./mvnw quarkus:dev`}</inlineCode>{`. It is important to configure a `}<inlineCode parentName=\"p\">{`.env`}</inlineCode>{` file with the needed environment variables to remote connect to Kafka Cluster using a SCRAM user:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`export KAFKA_USER=app-scram\nexport KAFKA_PASSWORD=<>\nexport KAFKA_BOOTSTRAP_SERVERS=eda-dev-kafka-bootstrap-eventstreams.<....>.cloud:443\nexport KAFKA_SSL_TRUSTSTORE_LOCATION=\\${PWD}/certs/truststore.p12\nexport KAFKA_SSL_TRUSTSTORE_PASSWORD=<>\nexport TELEMETRY_TOPIC=coldchain-telemetries\nexport REEFER_TOPIC=coldchain-reefers\nexport PREDICTION_ENABLED=false\nexport EDA_LOGGING_LEVEL=INFO\nexport KAFKA_SASL_MECHANISM=SCRAM-SHA-512\n`}</code></pre>\n    <p>{`See the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/ibm-cloud-architecture/vaccine-monitoring-agent\"\n      }}>{`repository readme`}</a>{` to build and run it locally or to deploy to openshift. `}</p>\n    <p>{`Also the `}<a parentName=\"p\" {...{\n        \"href\": \"/vaccine-solution-main/use-cases/cold-chain/\"\n      }}>{`cold chain monitoring use case`}</a>{` presents how to deploy on openshift, but it uses the Kubernetes config and source to image capability so one command will build and deploy to OpenShift:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`./mvnw clean package -Dquarkus.kubernetes.deploy=true -DskipTests\n`}</code></pre>\n    <h2>{`Usage details`}</h2>\n    <p>{`The demonstration script for this component is described in the `}<a parentName=\"p\" {...{\n        \"href\": \"/vaccine-solution-main/use-cases/cold-chain/\"\n      }}>{`cold chain monitoring use case`}</a>{`. `}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}