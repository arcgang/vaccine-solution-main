(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{dnaX:function(e,a,t){"use strict";t.r(a),t.d(a,"_frontmatter",(function(){return r})),t.d(a,"default",(function(){return b}));var i=t("wx14"),n=t("zLVn"),o=(t("q1tI"),t("7ljp")),s=t("013z"),r=(t("qKvR"),{}),c={_frontmatter:r},p=s.a;function b(e){var a=e.components,t=Object(n.a)(e,["components"]);return Object(o.b)(p,Object(i.a)({},c,t,{components:a,mdxType:"MDXLayout"}),Object(o.b)("p",null,"This microservice manages vaccine orders for a world wide demand and distribution. This is an example of using ",Object(o.b)("a",{parentName:"p",href:"https://quarkus.io"},"Quarkus"),", microprofile ",Object(o.b)("a",{parentName:"p",href:"https://smallrye.io/smallrye-reactive-messaging/smallrye-reactive-messaging/2/concepts.html"},"Reactive Messaging"),", ",Object(o.b)("a",{parentName:"p",href:"https://debezium.io/documentation/reference/integrations/outbox.html"},"Debezium outbox quarkus extension")," with Debezium ",Object(o.b)("a",{parentName:"p",href:"https://debezium.io/documentation/reference/connectors/postgresql.html"},"change data capture  for Postgresl")," to Kafka. The database is Postgresql, the service uses Hibernate ORM with Panache. "),Object(o.b)("p",null,"The DevOps is supported by Git Action and then gitops repository."),Object(o.b)("h2",null,"Overview"),Object(o.b)("p",null,"This project implements a very simple event driven microservice to support the Create, Read, Update, of vaccine orders. This implementation highlights the following capabilities and patterns:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Quarkus reactive microservice using Microprofile 3.x - reactive messaging extension to consume Vaccine lot shipment plans"),Object(o.b)("li",{parentName:"ul"},"Postgresql with Hibernate ORM with ",Object(o.b)("a",{parentName:"li",href:"https://quarkus.io/guides/hibernate-orm-panache"},"Quarkus Panache")),Object(o.b)("li",{parentName:"ul"},"Quarkus Debezium Outbox pattern to get create OrderEvents while writing to the main VaccineOrderEntity table"),Object(o.b)("li",{parentName:"ul"},"Integrate a Kafka Connector with Debezium change data capture table updates on the OrderEvents table.")),Object(o.b)("p",null,"In term of business scenario, a sale representative uses his mobile device or web browser to enter information about a vaccine order to be shipped to a given country or a province within a country at given date for a given quantity: "),Object(o.b)("p",null," ",Object(o.b)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(o.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"49.65277777777777%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaElEQVQoz42QS0/CUBCF+6cMUdYm/ghfK127decewoIEkN6+2xT+DEtc8XDjghCppiXQAseZKWANgdjk69x7Zu65p9VKt1WU7365IM5JO7uuHKV0U91SQfm+iqvHGi4fanJWa7YtNNvmlnxdb+oFjdBzvUG8KgtPLw08PtdpzkCLei3dlMozmu+52OPn1TQUPNcRbNsiTNFdxxaNTdmc14HvoeihOY6DHBeO60rVdQXTsmARyjBgEC71bNvOId2hi/gc666cy3203YYH2cA0TTLUxYRrjpK9UkrY6azxPLMzl4S+76PX66Hf72M0Gu0Zj8fCOzEYDDAcDv/0i4RhKKE0fgVBgNlshizL8J9nvV4faN1uV75QDDnhdDrFarVCmqZizOvlconFYom3jwQpaVlGGvWTJJGZIgeGURTJTZvN5mQ67vOlRxPyP/Q8D5PJhNIsEMexJDjFfD6XGhOfXzGi7xhhpyOGP+O+fQ6RWgP2AAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(o.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"order ui",title:"order ui",src:"/vaccine-solution-main/static/034f8a378d8e405b0e5e9ccbc47e6bce/3cbba/order-ui.png",srcSet:["/vaccine-solution-main/static/034f8a378d8e405b0e5e9ccbc47e6bce/7fc1e/order-ui.png 288w","/vaccine-solution-main/static/034f8a378d8e405b0e5e9ccbc47e6bce/a5df1/order-ui.png 576w","/vaccine-solution-main/static/034f8a378d8e405b0e5e9ccbc47e6bce/3cbba/order-ui.png 1152w","/vaccine-solution-main/static/034f8a378d8e405b0e5e9ccbc47e6bce/433df/order-ui.png 1356w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    ")),Object(o.b)("p",null,"The user interface is for demonstration purpose only, and illustrates some standard Vuejs / vuetify components. "),Object(o.b)("p",null,"The following diagram presents the simple context view of the service deployed on OpenShift, integrated with Kafka, Change data capture and the ",Object(o.b)("a",{parentName:"p",href:"/vaccine-solution-main/solution/orderms/voro-solution/"},"Vaccine order reefer optimization service"),". The integration with this component is using pub/sub via Kafka topics. The integration with Blockchain is not done yet, but it can be seen as the source of truth for the business companies participating to then end to end delivery.  "),Object(o.b)("p",null," ",Object(o.b)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"777px"}},"\n      ",Object(o.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"54.861111111111114%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACZUlEQVQoz3VTTU8UQRCdH+Bf0EQvXr3qxV9AwtHEeEOMBw+aaDxoPCjoxRgOxotGRQUBY4DoBUiICjFRd1k2fizDQgI7u+4uzA473/35rO51vdmTN13TXfXqdVWPo5IYPIrAwh6MrbP0v1BpAuQpsm6IxY/rmF8o4N1SEe+XCoiCLpw4CPHiWRnPn6wRSpgYL6PToUCtkecCjEkLLiRyxhEnKczY9nwcHhjFyaGHOHX+EQ6dvoFf7i6c0O9iaqKE6VdFvJlcw+zMOoIggSZCzgSklHY+oOyccyLn0Eqj7YcYuj2Jy/ff4urYHM5cf4pGow0HkkELTmpyxHEGRkFSSUsklYKmR5Cdp7xHzoVV6DUDnDj7AEcGRnB08C6ODY6iVmvC2dj2sfqzg4yO1B9ZRsSUQEllySxRzv/ZoCSt/S7O3XyJCyNTuHhvBoNXHuN3Yw/O8FgRxy+t4IvrI00SHEQpEiKstzpotgNSKRDSehBQsyDxY8tDfZ9sLS2UOY0ySeib5XDGF7Zxa3oLBbeF4TuvcW1sHu5OA9PL3/CpvGkVz62Wsby2YW0/YuimypIJ1TuVJhhilWdUQ8HsoiIlbT9ARF2st/Yw++ErSps7VNsUi58LWCl+RxiGxtNCiF6tlVY99AmVqRW5CGpALqSdD6IY+9TVerOJymYVFdeF12ggTDOk1GWDOGPW1zTNvonUHlnFVA/OIIk4ienCEhg5p3ECb7eGes1D1a3Crbh2LyfSLCFiuhEmRnMSRPGa1GmqtaOj0N5+TX+M+gsZ92ZqNdkRvGoVe7VdaPLr7xn0Y8y6NsLI/gNb3yd/iqadZQAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(o.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"Deployment view",title:"Deployment view",src:"/vaccine-solution-main/static/f687ca251b28950f8caa6b410572107d/c53c3/vaccine-order-1.png",srcSet:["/vaccine-solution-main/static/f687ca251b28950f8caa6b410572107d/7fc1e/vaccine-order-1.png 288w","/vaccine-solution-main/static/f687ca251b28950f8caa6b410572107d/a5df1/vaccine-order-1.png 576w","/vaccine-solution-main/static/f687ca251b28950f8caa6b410572107d/c53c3/vaccine-order-1.png 777w"],sizes:"(max-width: 777px) 100vw, 777px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    ")),Object(o.b)("p",null,"The component writes to the database all the orders received, but also produces records to Kafka via the Outbox pattern and Debezium change data capture."),Object(o.b)("p",null,"The Quarkus Debezium outbox pattern is described in ",Object(o.b)("a",{parentName:"p",href:"https://debezium.io/documentation/reference/integrations/outbox.html"},"this note"),". The configuration used is in the ",Object(o.b)("inlineCode",{parentName:"p"},"application.properties"),":"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'quarkus.debezium-outbox.id.name=aggregateid\nquarkus.debezium-outbox.id.column-definition="DECIMAL NOT NULL"\nquarkus.index-dependency.outbox.group-id=io.debezium\nquarkus.debezium-outbox.aggregate-id.name=aggregateid\nquarkus.debezium-outbox.aggregate-id.column-definition="DECIMAL NOT NULL"\nquarkus.index-dependency.outbox.artifact-id=debezium-quarkus-outbox\nquarkus.debezium-outbox.table-name=orderevents\n')),Object(o.b)("p",null,"Another view could be a pods view of the solution to deploy. The Debezium change data capture is a Kafka connector."),Object(o.b)("p",null," ",Object(o.b)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"796px"}},"\n      ",Object(o.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"53.81944444444444%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACV0lEQVQoz3WSyU8UURDGufsHePQ/8ODd6NGLesCbMfFgXIIHYvSikYNGuBAjBphxSyQugIga4wEiEYGAjDGDIMNsiPQM9GzMPj29TffP128gBJdKvlTeq1dffa+qWqx6HcfSKeVK/PimEFpISMRDm5iahmPqGLUaSjhNMpphbUVlPZKS54JawLUMzLqBx+M2bFosp4FnpYpORDyMxdLE4xnWlS1sx5Gxmm7S6Z+Q8L2Ylei4P8bA2wD5mklr9yKX/UvQsAShYAWXvebIu3KljJJQ0ET1l+MBBj7M8fHrMmNflnj0bob3U0FyZZ2DV2Y5fjsgUoRCVyTGExmWf6oSS/FNXLeBI5Qblim8jZorshjZIBRXCYYSfA8nWY6pRH+lcVyHVMkgV6g1FXp6+l5Ns+/IDQ6c7GL/sVucuzOCV8hqNNsxOB7kQvsb+vrm6ffP43sQoKtzirPXhjFsY/tTtpiFSYtXoaLV8b+eoWdwEt/INL3Dn8WdLqt7NjKxwNHTPVy6PkhbxxBtN4c4dfExre1PaHhEeOJMMSCzqbD72ScOnbnHiatPOXy+H9/onCTa6WxVTDEYVVhZF21Z25R+cTVJREnJ1rhSoLVLuJHe4u7zCR6OztA7NCm9adsUS0Uy2SzVaoX/mS2GuofQsBvolv3Xw3yxTCgSJRxblT6dy6MZllghQ67RDnTTlv12dr7c0Ovo1Rr1yi70qkalUCSfzqIqSeLhCPlMFkvzllyTMLe9JZbfNXRcrdYkdE2DP+GIB4gg4julbIatlIpXuBnX+VeO68VFP38DyTYaalQ1KYIAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(o.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"Pods view",title:"Pods view",src:"/vaccine-solution-main/static/12c09f9e300a816faf3c7b2d3c7719f2/8a22c/pods-map.png",srcSet:["/vaccine-solution-main/static/12c09f9e300a816faf3c7b2d3c7719f2/7fc1e/pods-map.png 288w","/vaccine-solution-main/static/12c09f9e300a816faf3c7b2d3c7719f2/a5df1/pods-map.png 576w","/vaccine-solution-main/static/12c09f9e300a816faf3c7b2d3c7719f2/8a22c/pods-map.png 796w"],sizes:"(max-width: 796px) 100vw, 796px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    ")),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Github repository:")," ",Object(o.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/vaccine-order-mgr-pg"},"Vaccine-order-mgr-pg")),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Kafka topics produced to:")," vaccine.public.orderevents\n",Object(o.b)("strong",{parentName:"p"},"Kafka topics consumed from :")," vaccine.shipment.plans"),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Events produced:")),Object(o.b)("p",null,"We will simplify the process and aggregate in the following event types:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"orderCreated"),Object(o.b)("li",{parentName:"ul"},"orderUpdated")),Object(o.b)("p",null,"The following environment variables are used by the application, and configured via the ",Object(o.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/vaccine-order-mgr-pg/blob/master/src/main/resources/application.properties"},"src/main/resources/application.properties"),"."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-properties"},"quarkus.openshift.env.configmaps=vaccine-order-ms-cm\nquarkus.openshift.env.secrets=vaccine-order-secrets\nquarkus.openshift.env.mapping.KAFKA_SSL_TRUSTSTORE_PASSWORD.from-secret=eda.dev-cluster-ca-cert\nquarkus.openshift.env.mapping.KAFKA_SSL_TRUSTSTORE_PASSWORD.with-key=ca.password\nquarkus.openshift.mounts.es-cert.path=/deployments/certs/server\nquarkus.openshift.secret-volumes.es-cert.secret-name=eda-gse-cluster-ca-cert\n")),Object(o.b)("h2",null,"Build and deploy to OpenShift"),Object(o.b)("p",null,"This microservice is built using maven and Quarkus extensions. We have already pushed the last version of this service on dockerhub, if you do not want to build it. "),Object(o.b)("p",null,"To build and run locally see the ",Object(o.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/vaccine-order-mgr-pg"},"repository main readme")," as we have different docker-compose files to run in demonstration mode or in development mode."),Object(o.b)("p",null,"To build and deploy to OpenShift, you can follow the step by step instructions in ",Object(o.b)("a",{parentName:"p",href:"/vaccine-solution-main/use-cases/order/"},"this scenario"),"."),Object(o.b)("p",null,"As an alternate you can use the different scripts from the ",Object(o.b)("inlineCode",{parentName:"p"},"vaccine-order-mgr-pg")," project:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Clone the source git repository: ",Object(o.b)("inlineCode",{parentName:"p"},"git clone https://github.com/ibm-cloud-architecture/vaccine-order-mgr-pg"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Set some environment variables in ",Object(o.b)("inlineCode",{parentName:"p"},"./src/main/scripts/setenv.sh")," script.")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Deploy postgresql"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-shell"},"cd ./src/main/scripts/\ndeployPostgresql.sh\n")))),Object(o.b)("p",null,"In this section we address how to use OpenShift Source to Image to build and deploy the application to OpenShift. The application is using environment variables to access to user, password, URLs to access Postgres and Kafka. We are using Event Streams deployed in Cloud Pak for Integration, but it could work the same with Strimzi. "),Object(o.b)("p",null,"As an example we created the OpenShift project called “vaccine” with a command: ",Object(o.b)("inlineCode",{parentName:"p"},"oc new-project vaccine"),"."),Object(o.b)("h3",null,"Deploy the application"),Object(o.b)("p",null,"See readme file in project repository and the ",Object(o.b)("a",{parentName:"p",href:"/vaccine-solution-main/use-cases/order/"},"order optimization use case description")),Object(o.b)("p",null,"The application uses Quarkus OpenShift extension to create yaml files for OpenShift and deploy the application using source to image capability of OpenShift:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-shell"},"source .env\n./mvnw clean package -Dui.deps -Dui.dev -Dquarkus.kubernetes.deploy=true -DskipTests\n")),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"-Dui.deps -Dui.dev")," arguments are used to prepare and build the vue.js app from the ",Object(o.b)("inlineCode",{parentName:"p"},"ui")," folder. The packaging build a runner jar and push it to the private image registry in OpenShift."),Object(o.b)("p",null,"It can take some seconds to build and deploy: ",Object(o.b)("inlineCode",{parentName:"p"},"oc get pods -w")," lets you see the build pods and the running app once the build is done. As we set properties to expose the application, an OpenShift route was created. "),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Be sure to get the Order Microservice URL to access the user interface, using ",Object(o.b)("inlineCode",{parentName:"p"},"oc get routes")," on the project. Using your web browser, pointing to this address you should get the UI:"),Object(o.b)("span",{parentName:"li",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(o.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"23.61111111111111%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6UlEQVQY033Oz0oDMRDH8byP9CJL1bvgU/gwFau91QfwSURBBUFbDxaaLZSynqrFS7vN/t9Nvk2igqB24MOPkJlhRHAWsn8+4aA3sRkSdCWtzpjWiWSnIzm6mHJ8GXHYn9K2fY7rD7qhn3HadsfuqWTPzotBFPM0W3rDaMXwdc3AupUfXL3MuZcLHsIFd+N3rkdzbkZvPNreZ9vzk9vjUoAhT5WnqwLQX2obFaYpP9Wl/3e5rUSjDSrNWK0TYpWyjJUX+3eCSjKvKCuquvHczH+EMfbCvCDNcjIn/1b4bLRGa/3rEjf3V20AKZhm7Mem2RQAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(o.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"ui home",title:"ui home",src:"/vaccine-solution-main/static/8adfb4a7fecbd26be951ba70b298f157/3cbba/ui-home.png",srcSet:["/vaccine-solution-main/static/8adfb4a7fecbd26be951ba70b298f157/7fc1e/ui-home.png 288w","/vaccine-solution-main/static/8adfb4a7fecbd26be951ba70b298f157/a5df1/ui-home.png 576w","/vaccine-solution-main/static/8adfb4a7fecbd26be951ba70b298f157/3cbba/ui-home.png 1152w","/vaccine-solution-main/static/8adfb4a7fecbd26be951ba70b298f157/0b124/ui-home.png 1728w","/vaccine-solution-main/static/8adfb4a7fecbd26be951ba70b298f157/4ea69/ui-home.png 2304w","/vaccine-solution-main/static/8adfb4a7fecbd26be951ba70b298f157/19a13/ui-home.png 2512w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    "))))}b.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-solution-orderms-index-mdx-be6a2196c23c91d94a4f.js.map