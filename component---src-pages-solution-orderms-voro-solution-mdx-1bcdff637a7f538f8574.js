(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{h54W:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return r})),a.d(t,"default",(function(){return d}));var n=a("wx14"),c=a("zLVn"),i=(a("q1tI"),a("7ljp")),o=a("013z"),r=(a("qKvR"),{}),s=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(i.b)("div",t)}},l=s("AnchorLinks"),p=s("AnchorLink"),b={_frontmatter:r},m=o.a;function d(e){var t=e.components,a=Object(c.a)(e,["components"]);return Object(i.b)(m,Object(n.a)({},b,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)(l,{mdxType:"AnchorLinks"},Object(i.b)(p,{mdxType:"AnchorLink"},"Overview"),Object(i.b)(p,{mdxType:"AnchorLink"},"Build"),Object(i.b)(p,{mdxType:"AnchorLink"},"Run locally"),Object(i.b)(p,{mdxType:"AnchorLink"},"Deploy to OpenShift"),Object(i.b)(p,{mdxType:"AnchorLink"},"Usage Details")),Object(i.b)("h2",null,"Overview"),Object(i.b)("p",null,"This service is exposing a send order and optimize API to build a shipment plan for all the vaccine lots given a new order. The implementation use CPLEX and an event driven solution to get a continuous streams of information coming frm the manufacturing, the refrigerator inventory and the available transportation capacity and cost."),Object(i.b)("p",null,"The following diagram illustrates all the components working together to support and event-driven shipment plan real time optimization:"),Object(i.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(i.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"44.44444444444444%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACDElEQVQoz1WSS2tTQRTH85H8BAoiuHAjrkTEjYqI4ELcCQpSXLhwIzWtRF1FLZJqSoOP2jZaromp5FVDX2jzanqT9N6b+37N3L/nTmPQgT+HOXPOb86cOYnIMhGaBhxNmygwdOHjdMZtE76uC19s3dEInj6iPZ3bFuDYgOccxZISPPARRhx/l+l6uHTvFS5PvcH5O2lcvPsSPmPQLBu5Qg0r5U3kinVUdluIwCFrOhrNfdi+D0bgBFgARbcwkykgSXrwYhlnbj5FdrWK+eUyFvI1cdGQEtMfJbz78gPpDxKk2hZ5OVryIfKVbTieB+7GwChEp6/i7K0Uzt1+LmCnb8xiszlAd6CjKWtgnEMxTGRWS3j/rSpsqbFLQIYDZUTVtuHGFcbAyPcQsFDcBnqE5bg4dX0GJ64+ITuLYxce4eBQh+k4eL1UxMJaGXOfi5Dq2yKnM1BRaPyCTRUeAamHPgH5uI+qYRMoieNXHgudvDYN3fYowcd8fh2LUkVUWNjYEcB2XxHAOJ974wr9MEBI0IicFn1Kcm4F96czmEq+xcNUFq1OF+39HnJSGUvf68hSH6s7e1BUFesbW6KPv3t9OPTzokJCiWfHYpMfj8bisGk8HBoPxhnFBKKAeO3JQzzLfcWn0k+kFtfQI2ginsOIgv8Vsywwe2ypd+h2AVlG5Lr/xcWzagyHE4U0q38AD8+EiOZccz4AAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(i.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"Components",title:"Components",src:"/vaccine-solution-main/static/c2c7d437f38708884e457041dbee89be/3cbba/voro-components.png",srcSet:["/vaccine-solution-main/static/c2c7d437f38708884e457041dbee89be/7fc1e/voro-components.png 288w","/vaccine-solution-main/static/c2c7d437f38708884e457041dbee89be/a5df1/voro-components.png 576w","/vaccine-solution-main/static/c2c7d437f38708884e457041dbee89be/3cbba/voro-components.png 1152w","/vaccine-solution-main/static/c2c7d437f38708884e457041dbee89be/0b124/voro-components.png 1728w","/vaccine-solution-main/static/c2c7d437f38708884e457041dbee89be/382d6/voro-components.png 1798w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    "),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"The app is done in python with Flask and Gunicorn WSGI server to run in a container deployable on Openshift. The ",Object(i.b)("a",{parentName:"li",href:"https://github.com/ibm-cloud-architecture/vaccine-order-optimizer/blob/master/Dockerfile"},"Dockerfile is here")),Object(i.b)("li",{parentName:"ol"},"A set of ",Object(i.b)("a",{parentName:"li",href:"https://github.com/ibm-cloud-architecture/vaccine-order-optimizer/tree/master/server/api"},"Resource classes")," expose REST API for orders and optimization. For demonstration purpose other resoources are implemented."),Object(i.b)("li",{parentName:"ol"},"The optimization component transforms the data to pandas structure for CPLEX to run. As the domain was very limited, it can run internally to the python app, but a remote client is also implemented to access the decision optimization service when the problem is becoming more complex."),Object(i.b)("li",{parentName:"ol"},"A set of Kafka consumers, using AVRO schema are used to get real time data.")),Object(i.b)("p",null,"See the code in this ",Object(i.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/vaccine-order-optimizer"},"Vaccine order optimizer github repository.")),Object(i.b)("p",null,"The application is deployed on OpenShift and participates with other components to demonstrate the vaccine order processing, as illustrated below:"),Object(i.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(i.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"53.125%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACfUlEQVQoz12SS2/TUBCFI7HjF7HqX2DLP2CHhJB4SbCpWCAWLFgVBKgVtEWV+gBBQFCE2lSlpUkTtaVp7DbOs3nbvn7bsT9u0gKCKx0d2zP3zPHMpHLZIm+WMiy+2xzz1tYBeDaxMMGx8HoD8msKxe0yhXUVJauRWIJINwglIsNgaJrEEqPvqSt357g4cY+Jq1NcuHSHyzemGR3HDQnDIablM/c6x9ulfRbm86ws7TH/qkD6fYmVxUMy6xq/T2zopObSO0w+TTOzvMnkszSz6R/j4DAe4rsBseSYCFu4hFGIMB3yuQq5HY2lhTzfVktoJwM6XQeEQcq23TN1P4IkgSjGtQM8KWb2HRzh4zoBYuDKAiG26Y/z6xWd29c/MvXkOzevfWDmRQ4Cm9SjBxmmn2fx/JB4GBN4Ib5EksSEbkQYhESSXSkcx7KYFIzCCL1tcXTYoKy1UJUm7Y555vD+rc88friGsG32yzVyxTJe4FNtd8nsHmE5DhuFEie1NuXTDms7RZpyUF+3D2j19N/dI0qGhP0eKfX4lG5Xxw9DljN5Zle3CaKI7JHGdHoDw3aY+bTJXrlBXq0x+2WLUq3FSxlTG50//Y6k+7GgkBdGjTfl2Dd3f7J7UJbTjTjtdNFqzbFzrd6kUm/Q6nSoNlv05aq0en1czzt3mDBMzgVtP8YUASW1Sq3els8epuMhXF+6c+kZAlWrcnCkcKgcMxA2lheMMcoxJUasOz6+LJKyTBvbsHAtV07URuhiDEtCU8soRYXKcYXifpGu7KEj10YMTAnxT64h3335V6nRlg91/S/kco4WdMSJjLUUhUImQ/fkhESc5cbG/zDGnHQ7/ALJPiMpIP2ocgAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(i.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"End to end scenario",title:"End to end scenario",src:"/vaccine-solution-main/static/38d319ff54fc4d42ae520aa48ce575cb/3cbba/order-simulated.png",srcSet:["/vaccine-solution-main/static/38d319ff54fc4d42ae520aa48ce575cb/7fc1e/order-simulated.png 288w","/vaccine-solution-main/static/38d319ff54fc4d42ae520aa48ce575cb/a5df1/order-simulated.png 576w","/vaccine-solution-main/static/38d319ff54fc4d42ae520aa48ce575cb/3cbba/order-simulated.png 1152w","/vaccine-solution-main/static/38d319ff54fc4d42ae520aa48ce575cb/4dbac/order-simulated.png 1560w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    "),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"An external app is managing the order life cycle and can be accessible from the ",Object(i.b)("a",{parentName:"li",href:"https://github.com/ibm-cloud-architecture/vaccine-order-mgr"},"Vaccine Order manager")," git repository.\n1.This Vaccine Order Reefer Optimization component."),Object(i.b)("li",{parentName:"ol"},"Manufacturer simulator to be send a vaccine lot inventory to the ",Object(i.b)("inlineCode",{parentName:"li"},"vaccine-inventory")," Kafka topic."),Object(i.b)("li",{parentName:"ol"},"Refrigerator manager to manage the availability of refrigerator container to carry the vaccine lots"),Object(i.b)("li",{parentName:"ol"},"Transportation simulator to send updated itinerary update.")),Object(i.b)("h2",null,"Build"),Object(i.b)("p",null,"Simply build the docker image and push it to your registry. Here is an example of commands:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"docker build -t ibmcase/vaccine-order-optimizer .\n\ndocker push ibmcase/vaccine-order-optimizer\n")),Object(i.b)("p",null,"The repository include a ",Object(i.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/vaccine-order-optimizer/blob/master/.github/workflows/dockerbuild.yaml"},"github action workflow")," to build and push the image automatically to the ",Object(i.b)("a",{parentName:"p",href:"https://hub.docker.com/repository/docker/ibmcase/vaccine-order-optimizer"},"public docker registry.")),Object(i.b)("p",null,"The flow uses a set of secrets in the git repo:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"DOCKER_IMAGE_NAME = vaccine-order-optimizer"),Object(i.b)("li",{parentName:"ul"},"DOCKER_REPOSITORY = ibmcase"),Object(i.b)("li",{parentName:"ul"},"DOCKER_USERNAME and DOCKER_PASSWORD")),Object(i.b)("h2",null,"Run locally"),Object(i.b)("p",null,"It is possible to run the code on your laptop or server but connected to Event Streams deployed on OpenShift. Some pre-requisites need to be done:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Get the Kafka URL, schema registry URL, the user and password and any pem file containing the server certificate."),Object(i.b)("li",{parentName:"ul"},"The certificate needs to be under certs folder."),Object(i.b)("li",{parentName:"ul"},"Copy the script/setenv-tmpl.sh  to script/setenv.sh"),Object(i.b)("li",{parentName:"ul"},"modify the environment variables.")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-shell"},"source ./script/setenv.sh\n\ndocker run -ti -e KAFKA_BROKERS=$KAFKA_BROKERS -e SCHEMA_REGISTRY_URL=$SCHEMA_REGISTRY_URL -e REEFER_TOPIC=$REEFER_TOPIC -e INVENTORY_TOPIC=$INVENTORY_TOPIC -e TRANSPORTATION_TOPIC=$TRANSPORTATION_TOPIC -e KAFKA_USER=$KAFKA_USER -e KAFKA_PASSWORD=$KAFKA_PASSWORD -e KAFKA_CERT=$KAFKA_CERT -p 5000:5000  ibmcase/vaccine-order-optimizer\n")),Object(i.b)("p",null,"The swagger looks like:"),Object(i.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(i.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"62.15277777777778%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABjElEQVQoz43S6W6dMBAFYN7/ZSpV6vYK/dGqrZRIAQxcNpvFYGNjtnA6EKVL1NxbxKeRGHQ0ZvBE1cAPIsTJBVF8AYsSBGF8Vj9g57MHn1E/hbUj1mXBPM9YqP6LV3cGftogFxJd16NtJZTScG4i7jSSaZrOoFs8NVi0vYFxM9Z1/cu2bb+87L3Gc9bAGY39ccPTtf+273Q/kv2/eXmtcRfX0Mai1wbHxM8G62BpcjNOV1lyvkvV+5YveHfnEJcSYf4kKnvEvMel0ig7B6Fm8H6GeA31S6qdoW/4o9jw6X5FXFBYJsGOwKJDwhXyxoJTYKUWMl/FnwO/iwHv/YamqhFkFVhRI+ItkqpD1igUcoDQ401cjRTo4H2RDG+yz2BVhgeeIKxSsDpD3BZIlUBpGtLelJsaclQ0YaXwIeQ0YYWgEAipMpo2bToUnQanRQnCrzj6pTKQ9ON7X2uBt5FPxxRg5NI0yKSEMHTUYQAf9E2ClFpToD2WsuLj/YykPBahz0UcSxDXtvrCn0v5CRfYkUuZixM6AAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(i.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"openAPI",title:"openAPI",src:"/vaccine-solution-main/static/2c23d1c168f014258ba0c9854b56d52f/3cbba/oro-swagger.png",srcSet:["/vaccine-solution-main/static/2c23d1c168f014258ba0c9854b56d52f/7fc1e/oro-swagger.png 288w","/vaccine-solution-main/static/2c23d1c168f014258ba0c9854b56d52f/a5df1/oro-swagger.png 576w","/vaccine-solution-main/static/2c23d1c168f014258ba0c9854b56d52f/3cbba/oro-swagger.png 1152w","/vaccine-solution-main/static/2c23d1c168f014258ba0c9854b56d52f/f9628/oro-swagger.png 1343w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    "),Object(i.b)("h2",null,"Deploy to OpenShift"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Connect to the vaccine project using: ",Object(i.b)("inlineCode",{parentName:"p"},"oc project vaccine"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Modify the kubernetes/configmap.yaml with the Kafka Broker URL you are using, and if you changed the topic names too. Then do:"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell"},"oc apply -f kubernetes/configmap.yaml\n"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Get pem certificate from eventstreams or the Kafka cluster project to the local vaccine project with a command like:"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell"},"oc get secret light-es-cluster-cert-pem  -n eventstreams --export -o yaml | oc apply -f - \n")),Object(i.b)("p",{parentName:"li"},"This pem file is mounted to the pod via the secret as:"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"volumeMounts:\n- mountPath: /certs\n name: eventstreams-cert-pem\nvolumes:\n- name: eventstreams-cert-pem\n secret:\n   secretName: light-es-cluster-cert-pem\n")),Object(i.b)("p",{parentName:"li"},"and the path for the python code to access this pem file is defined in the environment variable: "),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-yaml"}," - name: KAFKA_CERT\n   value: /certs/es-cert.pem\n")),Object(i.b)("p",{parentName:"li"},"the name of the file is equal to the name of the {.data.es-cert.pem} field in the secret."),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"Name:         eventstreams-cert-pem\nNamespace:    vaccine\nLabels:       <none>\nAnnotations:  <none>\n\nType:  Opaque\n\nData\n====\nes-cert.pem:  1164 bytes\n"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Copy the Kafka user’s secret from the ",Object(i.b)("inlineCode",{parentName:"p"},"eventstreams")," or Kafka project to the current vaccine project. This secret has two data fields: username and password"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell"},"oc get secret app-user-tls  -n eventstreams --export -o yaml | oc apply -f - \n")))),Object(i.b)("p",null,"They are used in the Deployment configuration as:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"- name: KAFKA_USER\n   valueFrom:\n     secretKeyRef:\n       key: username\n       name: app-user-tls\n - name: KAFKA_PASSWORD\n   valueFrom:\n     secretKeyRef:\n       key: password\n       name: app-user-tls\n")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Deploy the application using: ",Object(i.b)("inlineCode",{parentName:"li"},"oc apply -f kubernetes/app-deployment.yaml"))),Object(i.b)("h2",null,"Usage Details"),Object(i.b)("p",null,"This section addresses how to validate the app is running. "),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Once the application is deployed on OpenShift get the routes to the external exposed URL:"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-shell"}," oc describe routes vaccine-order-optimizer \n"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Access the swagger. As an example of URL: http://vaccine-order-optimizer-vaccine…cloud/apidocs/")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Trigger the data loading with the operation:"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre"},'curl -X POST  http://vaccine-order-optimizer-vaccine......cloud/api/v1/optimize/loadData "\n'))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Send a new order"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre"},'curl -X POST -H "Content-Type: application/json" http://vaccine-order-optimizer-vaccine......cloud/    --data "@./data/order1.json"\n')))))}d.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-solution-orderms-voro-solution-mdx-1bcdff637a7f538f8574.js.map